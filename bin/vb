#!/bin/bash

case $1 in
    -0)
        $0 -r | grep . && read && $0 -r | cut -d ' ' -f 1 | xargs -n 1 $0 -s ;;
    -a)
        vboxmanage guestproperty enumerate $2 | sed -nr "s:.*V4/IP *= '([^']*).*:\1:p" ;;
    -b)
        vboxmanage controlvm $2 acpipowerbutton; sleep 15; $0 -r | grep -q $2 && $0 -p $2; exit 0 ;;
    -d)
        $0 -n $2; read -p '> ' s; vboxmanage snapshot $2 delete $s ;;
    -e)
        $0 -n $2; read -p '> ' s; vboxmanage snapshot $2 restore $s ;;
    -g)
        vboxmanage startvm $2 --type gui ;;
    -h)
        vboxmanage startvm $2 --type headless ;;
    -i)
        vboxmanage showvminfo $2 | less ;;
    -m)
        vboxmanage modifyvm $2 --memory $3 ;;
    -n)
        vboxmanage snapshot $2 list ;;
    -l)
        vboxmanage list -s vms ;;
    -p)
        vboxmanage controlvm $2 poweroff ;;
    -r)
        vboxmanage list runningvms | sort ;;
    -s)
        vboxmanage controlvm $2 savestate ;;
    -t)
        vboxmanage snapshot $2 take $(date +%F) ;;
    *)
        echo '-0: save running
-a vm: IP address
-b vm: powerbutton
-d vm: delete snapshot
-e vm: restore snapshot
-g vm: gui
-h vm: headless
-i vm: info
-l: list
-n vm: list snapshots
-m vm mb: memory
-p vm: poweroff
-r: running
-s vm: save
-t vm: take snapshot'
        exit 1 ;;
esac
