#!/bin/bash

w=${2:-.}

n=.nfo
u=https://www.imdb.com/title

[ -f $w/$n ] && . $w/$n

case $1 in
    -c)
        a=$(basename $(readlink -f $w))
        echo -e "=HYPERLINK(\"$u/$i\", \"${a%-*}\")\t${a#*-}\t$r\t$(date +%F -d $d)" ;;
    -d)
        for a in $(ls -t */$n | head -${2:-50}); do . $a; echo "$d $(dirname $a)"; done | sort ;;
    -f)
        firefox $u/$i ;;
    -i)
        a=$(date +%Y%m%d -d "${3:-today}")
        b=$(printf '%.1f' $(curl -Ls $u/$2 | sed -nr 's/.*"([^ ]*) based on [^ ]* user ratings".*/\1/p'))
        echo -e "d=$a\ni=$2\nr=$b" >> $n ;;
    -s)
        for a in */$n; do . $a; echo "$d $r $(dirname $a)"; done | sort | cut -c -31 | column ;;
    -u)
        echo $u/$i ;;
    *)
        echo -e '-c: cinerod\n-d: sort 2\n-f: firefox\n-i: .nfo\n-s: sort 1\n-u: imdb'; exit 1 ;;
esac
