#!/bin/bash

[ "$1" = -c ] && c=1 && shift
[ "$1" = -s ] && s=1 && shift
[ "$1" = -u ] && u=1 && shift

[ -z $1 ] && echo "Usage: $0 [-c] [-s] [-u] mail [xtra]" && exit 1

[ $s ] && sleep $((RANDOM%3600))

n=$(basename $0)
m=$1
x=${@:2}

h=yay
l=/tmp/$n.log

exec > $l 2>&1

ma () { tail -500 $l | tr -s " " | mail -s "$(hostname -s): $n $1" $m; }

trap "ma failed; exit 1" err

date
uptime | sed -r "s/.*(up [^,]*).*/\u\1/"

$h -Sy
echo

if $h -Qu | grep .; then
    [ $u ] && echo -e "\n--" && $h -Su --devel --noconfirm --removemake $x

    [ $c ] && yes | $h -Scc

    ma # ok
fi
