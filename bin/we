#!/bin/bash

[ -z $1 ] && echo sbrf && exit 1

cd /tmp

l=${1^^}.TXT
u=https://tgftp.nws.noaa.gov/data/observations/metar/stations/$l

[ -s $l ] && d=$(date -d "$(head -1 $l)" -u +%s) || d=0

[ $(($(date -u +%s) - $d)) -gt 3600 ] && curl -Os -z $l $u

[ ! -s $l ] && echo ! && exit 1

perl -0ne 'print /KT.*? ([-+]?[A-Z]{2,}).*? (M?[0-9]+)\// ? "$1 $2C\n" : "?\n"' $l
