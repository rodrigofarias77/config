#!/bin/bash

[ -z "$4" ] && echo "Usage: $0 url time base mail" && exit 1

u=$1
t=$2
b=$3
m=$4

l=/tmp/yl-$(date +%s).log

exec > $l 2>&1

te () { tail $l | mail -s "$HOSTNAME: $0" $m; }

trap te err int

date

for i in {0..9}; do ffmpeg -hide_banner -nostats -i "$(yt-dlp -f b -g $u)" -t $t -c copy $b-$(date +%s).mkv; sleep 60; done
