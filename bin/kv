#!/bin/bash

set -e

type curl jq k3s mail > /dev/null

[ -z "$1" ] && echo "Usage: $0 mail" && exit 1

m=$1

a=$(kubectl version -o json | jq -r '.serverVersion.gitVersion')
b=$(curl -s https://raw.githubusercontent.com/k3s-io/k3s/master/channel.yaml | sed -n 's/.*latest: //p')

[ "$a" != "$b" ] && echo "K3s $a can be upgraded to $b" | mail -s "$HOSTNAME: $0" $m
